<html>
<head>
	<title>6800 Scouting - 2018</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/skeleton/2.0.4/skeleton.min.css">
	<link rel="stylesheet" href="assets/css/custom.css">
	<meta name="viewport" content="width=device-width" />
</head>
<body>
<div class="topnav" id="nav_bar">
	<a href="index.html" class="active">Scout</a>
	<a href="pit_scout.html">Pit Scout</a>
	<a href="match-results.html">Match Results</a>
	<a href="data.html">Rankings</a>
	<a href="prematch.html">Pre-match</a>
	<a href="team.html">Team Lookup</a>
	<a href="index.html">Pick list</a>
	<a href="javascript:void(0);" class="icon" onclick="nav_bar_click()">&#9776;</a>
</div>

<br>

<div class="content-container">
	<div class="content">
		<form id="matchResultForm">
			<label for="general_row" class="rowheader">General</label>
			<div class="row" id="general_row">
				<div class="form-question">
					<label for="match_num">Match num.</label>
					<input class="u-full-width" type="text" id="match_num" required>
				</div>
				<div class="form-question">
					<label for="team_num">Team num.</label>
					<input class="u-full-width" type="text" id="team_num" required>
				</div>
				<div class="form-question">
					<label for="alliance">Alliance color</label>
					<select class="u-full-width required" id="alliance">
						<option value="red">Red</option>
						<option value="blue">Blue</option>
					</select>
				</div>
			</div>
			<hr>
			<label for="auto_row" class="rowheader">Autonomous</label>
			<div class="row" id="auto_row">
				<div class="form-question">
					<label for="auto_start">Start position</label>
					<select class="u-full-width required" id="auto_start">
						<option value="left">Left</option>
						<option value="center">Center</option>
						<option value="right">Right</option>
					</select>
				</div>
				<div class="form-question">
					<label>
						<span class="label-body">Cross auto line?</span>
						<select class="u-full-width required" id="auto_line">
							<option value=true>Yes</option>
							<option value=false>No</option>
						</select>
					</label>
				</div>
				<div class="form-question">
					<label for="auto_switch">Cubes scored in switch</label>
					<input class="u-full-width increment" type="text" id="auto_switch" value="0" required>
				</div>
				<div class="form-question">
					<label for="auto_scale">Cubes scored in scale</label>
					<input class="u-full-width increment" type="text" id="auto_scale" value="0" required>
				</div>
			</div>
			<hr>
			<label for="teleop_row" class="rowheader">Teleop</label>
			<div class="row" id="teleop_row">
				<div class="form-question">
					<label for="teleop_switch">Cubes scored in switch</label>
					<input class="u-full-width increment" type="text" id="teleop_switch" value="0" required>
				</div>
				<div class="form-question">
					<label for="teleop_scale">Cubes scored in scale</label>
					<input class="u-full-width increment" type="text" id="teleop_scale" value="0" required>
				</div>
				<div class="form-question">
					<label for="teleop_opp_switch">Cubes scored in opponent switch</label>
					<input class="u-full-width increment" type="text" id="teleop_opp_switch" value="0" required>
				</div>
				<div class="form-question">
					<label for="teleop_vault">Cubes scored in vault</label>
					<input class="u-full-width increment" type="text" id="teleop_vault" value="0" required>
				</div>
				<div class="form-question">
					<label for="defensive_rating">Defensive Rating</label>
					<select class="u-full-width required" id="defensive_rating">
						<option value="0">None</option>
						<option value="1">Bad</option>
						<option value="2">Poor</option>
						<option value="3">Average</option>
						<option value="4">Good</option>
						<option value="5">Great</option>
					</select>
				</div>
			</div>
			<hr>
			<label for="end_row" class="rowheader">End</label>
			<div class="row" id="end_row">
				<div id="hang_attempt_div" class="form-question">
					<label>
						<span class="label-body">Attempt hang?</span>
						<select class="u-full-width required" id="hang_attempt">
							<option class="yes" value=true>Yes</option>
							<option class="no" value=false>No</option>
						</select>
					</label>
				</div>
				<div id="hang_succeed_div" class="form-question hidden">
					<label>
						<span class="label-body">Successful hang?</span>
						<select class="u-full-width" id="hang_succeed">
							<option class="yes" value=true>Yes</option>
							<option class="no" value=false>No</option>
						</select>
					</label>
				</div>
				<div id="host_succeed_div" class="form-question hidden">
					<label>
						<span class="label-body">Hosted a hang?</span>
						<select class="u-full-width" id="host_succeed">
							<option class="yes" value=true>Yes</option>
							<option class="no" value=false>No</option>
						</select>
					</label>
				</div>
				<div id="hang_time_div" class="form-question hidden">
					<label for="hang_time">Hang time (seconds)</label>
					<input class="u-full-width increment" type="text" id="hang_time" value="0" required>
				</div>
			</div>
			<hr>
			<label for="comments" class="rowheader">Comments</label>
			<div class="row" id="comments_row">
				<label for="comments">Any other comments?</label>
				<input class="u-full-width" type="text" id="comments">
			</div>
			<hr>
			<input class="button-primary" type="submit" value="Submit" style="-webkit-appearance: none;">
		</form>
	</div>
</div>

</body>
<script src="https://www.gstatic.com/firebasejs/4.9.1/firebase.js"></script>
<script
				src="https://code.jquery.com/jquery-3.3.1.min.js"
				integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
				crossorigin="anonymous"></script>
<script src="assets/js/custom.js"></script>
<script>

  $('select').each(function() {

    var selectName = this.id;

    const required = $(this).hasClass('required') ? ' required' : '';

    var hidden = $('<input class="hide" id="'+selectName+'"' + required + '>');
    hidden.val(this.val);
    hidden.insertAfter(this);

    var optionDiv = $('<div class="select_options"></div>');
    optionDiv.insertAfter(this);

		// Add a button for each select option
    $("#"+selectName+" option").unwrap().each(function() {
			var value = this.value;
      var classes = this.className ? " " + this.className.trim() : "";
      var color = value == "red" || value == "blue" ? " " + value : "";
      var btn = $('<div class="btn btn_' + selectName + color + classes + '" value="'+ value +'">'+this.text+'</div>');
      optionDiv.append(btn);
      $(this).remove();
    });

    // Add click event listener
    $(document).on('click', '.btn_'+selectName, function() {
      $('.btn_'+selectName).removeClass('on');
      $(this).addClass('on');
      $('input[id="'+selectName+'"]').val($(this).attr('value'));
    });

  });

  $('.increment').each(function() {

    var input = $(this);

    var incrementDiv = $('<div class="increment_container"></div>');
    incrementDiv.insertBefore(input);

		var inputDiv = $('<div class="input_container"></div>');
    inputDiv.append(input);

    var minus = $('<div class="dec btn plusminus">-</div>');
    var plus = $('<div class="inc btn plusminus">+</div>');

    incrementDiv.append(minus);
    incrementDiv.append(inputDiv);
    incrementDiv.append(plus);

    // Add click event listener
    $(minus).on('click', function() {
      var oldValue = input.val();
      var newVal = parseFloat(oldValue) - 1;
      input.val(newVal);
    });

    // Add click event listener
    $(plus).on('click', function() {
      var oldValue = input.val();
      var newVal = parseFloat(oldValue) + 1;
      input.val(newVal);
    });

	});

  $('#hang_attempt_div > label > div > div.yes').click(function(){
    $("#hang_succeed_div").removeClass("hidden")
  });

  $('#hang_attempt_div > label > div > div.no').click(function(){
    $("#hang_succeed_div").addClass("hidden")
    $("#host_succeed_div").addClass("hidden");
    $("#hang_time_div").addClass("hidden");
  });

  $('#hang_succeed_div > label > div > div.yes').click(function(){
    $("#host_succeed_div").removeClass("hidden");
    $("#hang_time_div").removeClass("hidden");
  });

  $('#hang_succeed_div > label > div > div.no').click(function(){
    $("#host_succeed_div").addClass("hidden");
    $("#hang_time_div").addClass("hidden");
  });


  $('#matchResultForm').on('submit', function () {

    var valid = confirm('Are you sure you want to submit');
    if(valid) {
      var results = {};
      results['team_num'] = $('#team_num').val();
      results['alliance'] = $('#alliance').val();
      results['auto_start'] = $('#auto_start').val();
      results['auto_line'] = $('#auto_line').val() == 'true';
      results['auto_switch'] = parseInt($('#auto_switch').val());
      results['auto_scale'] = parseInt($('#auto_scale').val());
      results['teleop_switch'] = parseInt($('#teleop_switch').val());
      results['teleop_opp_switch'] = parseInt($('#teleop_opp_switch').val());
      results['teleop_scale'] = parseInt($('#teleop_scale').val());
      results['teleop_vault'] = parseInt($('#teleop_vault').val());
      results['defensive_rating'] = $('#defensive_rating').val();
      results['hang_attempt'] = $('#hang_attempt').val() == 'true';
      results['hang_succeed'] = $('#hang_succeed').val() == 'true';
      results['host_succeed'] = $('#host_succeed').val() == 'true';
      results['hang_time'] = parseInt($('#hang_time').val());
      results['comments'] = $('#comments').val();
      results['match_num'] = $('#match_num').val();

      writeMatchResult($('#team_num').val(), results);

      $('#matchResultForm').trigger("reset");
      $('.btn').removeClass('on');

    } else {
      alert('Not sumbitted');
    }
    return false;
  });

  firebase.initializeApp(config);

  // Write match results to firebase
  function writeMatchResult(teamNum, data) {

    // Calculate object hash
		const hash = getHash(teamNum + '__' + JSON.stringify(data));

		// Write object and hash to raw_results
    firebase.database().ref(regionalCode + '/raw_results/' + hash).set(data, function (error) {
			if (error) {
        alert('Error submitting match results ' + error);
        return;
			}
      // Write hash to team list
      firebase.database().ref(regionalCode + '/teams/' + teamNum + "/matches").push(hash, function (error) {
        if (error) {
          alert('Error submitting match results ' + error);
        }
        alert('Match results submitted!');
      });

    });

  }
</script>
</html>
