<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>ViperScout</title>

    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Open+Sans:400italic,400,600italic,600,700italic,700,800italic,800">
    <link rel="stylesheet" type="text/css" href="./styles.css">
    <script type="text/javascript" src="dist/sorttable.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-133390567-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-133390567-1');
    </script>
  </head>

  <body class="w3-padding-64">

      <div class="w3-top w3-bar w3-black w3-hide-small">
        <a href="index.html" class="w3-bar-item w3-button" id="home_button">ViperScout</a>
        <a href="all.html" class="w3-bar-item w3-button">All regionals/districts</a>
        <a href="prediction.html" class="w3-bar-item w3-button">Match Prediction</a>
        <a href="#" class="w3-bar-item w3-button w3-mobile w3-right viper-black-hover" id="questions_button">
          <i class="fa fa-question-circle" alt="Questions?"></i>
        </a>
      </div>

    <!-- Navbar on small screens (Hidden on medium and large screens) -->
    <div class="w3-top w3-light-grey w3-hide-large w3-hide-medium" id="myNavbar">
      <div class="w3-bar w3-center w3-large">
        <a href="index.html" class="w3-bar-item w3-button w3-light-grey" style="width:25% !important" id="home_button"><i class="fa fa-home" alt="Home"></i></a>
        <a href="all.html" class="w3-bar-item w3-button w3-grey" style="width:25% !important">All</a>
        <a href="prediction.html" class="w3-bar-item w3-button w3-light-grey" style="width:25% !important">Predict</a>
      </div>
    </div>

    <!-- Page Content -->
    <div class="w3-padding-large" id="main">
      
      <!-- Questions pop-up -->
      <div id="questions_alert" class="w3-justify w3-panel grey-no-hover w3-display-container w3-animate-opacity">
        <span id="getStartedClose" class="w3-button w3-xlarge red-hover w3-display-topright">&times;</span>
        <h3>Getting Started</h3>
        <p>The following list explains what some of the abbreviations are:</p>
        <ul>
            <li>C - Cargoship</li>
            <li>R - Rocket</li>
            <li>S - Side</li>
            <li>F - Front</li>
            <li>T - Top</li>
            <li>M - Middle</li>
            <li>L - Low</li>
        </ul>
        <p>Example: CF means Cargoship Front. RT = Rocket Top.</p>
        <p>OPR in this site is generated by summing up all the other columns. Start Avg is the average 
            points a team gets from their starting configuration. Climb Avg is the average points a team 
            gets from climbing. All other stats are component OPRs, which is calculated from 
            TheBlueAlliance data and Linear Least Squares Regression.</p>
      </div>

      <!-- Container for the item content viewer -->
      <div class="w3-justify w3-card w3-white" id="regional_details" style="display: none;">
        <header class="w3-container viper-black-no-hover">
          <h3><span id="regional_detail_name"></span></h3>
        </header>

        <!-- OPR table -->
        <table class="sortable w3-card w3-table w3-striped w3-hoverable" id="opr_table">
        <!--Generated items will go here-->
        </table>

      </div>

    <!-- END PAGE CONTENT -->
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/5.6.0/math.js"></script>
    <script type="text/javascript" src="dist/scripts.js"></script>
    <script src="./dist/bundle.js"></script>
  </body>

<script id="reg-header-table" type="text/template">
    <thead class="viper-grey">
        <th>Name</th>
        <th>Location</th>
        <th>Code</th>
    </thead>
</script>

<script id="reg-template-table-entry" type="text/template">
    <tr class="table_entry" id="{{name}}">
      <td class="table_entry_name" id="{{name}}">{{name}}</td>
      <td class="table_entry_location" id="{{location}}">{{location}}</td>
      <td class="table_entry_code" id="{{code}}">{{code}}</td>
    </tr>
</script>

<script id="opr-header-table" type="text/template">
    <thead class="viper-grey">
        <td>Team</td>
        <td>OPR</td>
        <td>Start Avg</td>
        <td>Climb Avg</td>
        <td>Hatch (C)</td>
        <td>Hatch (CS)</td>
        <td>Hatch (CF)</td>
        <td>Cargo (C)</td>
        <td>Cargo (CS)</td>
        <td>Cargo (CF)</td>
        <td>Hatch (R)</td>
        <td>Hatch (RT)</td>
        <td>Hatch (RM)</td>
        <td>Hatch (RL)</td>
        <td>Cargo (R)</td>
        <td>Cargo (RT)</td>
        <td>Cargo (RM)</td>
        <td>Cargo (RL)</td>
    </thead>
</script>

<script id="opr-template-table-entry" type="text/template">
    <tr class="table_entry" >
        <td><a href="{{url}}">{{team}}</a></td>
        <td>{{opr}}</td>
        <td>{{start_avg}}</td>
        <td>{{climb_avg}}</td>
        <td>{{cargo_panel_opr}}</td>
        <td>{{cargo_side_panel_opr}}</td>
        <td>{{cargo_front_panel_opr}}</td>
        <td>{{cargo_cargo_opr}}</td>
        <td>{{cargo_side_cargo_opr}}</td>
        <td>{{cargo_front_cargo_opr}}</td>
        <td>{{rocket_panel_opr}}</td>
        <td>{{rocket_high_panel_opr}}</td>
        <td>{{rocket_mid_panel_opr}}</td>
        <td>{{rocket_low_panel_opr}}</td>
        <td>{{rocket_cargo_opr}}</td>
        <td>{{rocket_high_cargo_opr}}</td>
        <td>{{rocket_mid_cargo_opr}}</td>
        <td>{{rocket_low_cargo_opr}}</td>
    </tr>
</script>

<script>
    
  $('#getStartedClose').on('click', function() {
      $('#questions_alert').hide();
      Cookies.set('getStartedClose', true, { expires: 365 });
  });
  
  $('#questions_button').on('click', function() {
    $("#questions_alert").show();
  });
  var tba = new TBA();

  // Cache of the template
  var OPRheader = document.getElementById("opr-header-table");
  var OPRtemplate = document.getElementById("opr-template-table-entry");
  // Get the contents of the template
  var OPRHeaderHtml = OPRheader.innerHTML;
  var OPRTemplateHtml = OPRtemplate.innerHTML;
  // Final HTML variable as empty string
  var listHtml = OPRHeaderHtml;

  tba.getRegionals(function(events) {
    for (var key in events) {
      tba.genOPRs(events[key], function(results) {
        if (results) {
          for (var team in results) {
              listHtml += OPRTemplateHtml.replace(/{{url}}/g, "https://www.thebluealliance.com/team/" + team)
                                    .replace(/{{team}}/g, team)
                                    .replace(/{{opr}}/g, results[team].opr.toFixed(2))
                                    .replace(/{{start_avg}}/g, results[team].start_avg.toFixed(2))
                                    .replace(/{{climb_avg}}/g, results[team].climb_avg.toFixed(2))
                                    .replace(/{{cargo_side_panel_opr}}/g, results[team].cargo_side_panel_opr.toFixed(2))
                                    .replace(/{{cargo_side_cargo_opr}}/g, results[team].cargo_side_cargo_opr.toFixed(2))
                                    .replace(/{{cargo_front_panel_opr}}/g, results[team].cargo_front_panel_opr.toFixed(2))
                                    .replace(/{{cargo_front_cargo_opr}}/g, results[team].cargo_front_cargo_opr.toFixed(2))
                                    .replace(/{{rocket_high_panel_opr}}/g, results[team].rocket_high_panel_opr.toFixed(2))
                                    .replace(/{{rocket_high_cargo_opr}}/g, results[team].rocket_high_cargo_opr.toFixed(2))
                                    .replace(/{{rocket_mid_cargo_opr}}/g, results[team].rocket_mid_cargo_opr.toFixed(2))
                                    .replace(/{{rocket_mid_panel_opr}}/g, results[team].rocket_mid_panel_opr.toFixed(2))
                                    .replace(/{{rocket_low_panel_opr}}/g, results[team].rocket_low_panel_opr.toFixed(2))
                                    .replace(/{{rocket_low_cargo_opr}}/g, results[team].rocket_low_cargo_opr.toFixed(2))
                                    .replace(/{{cargo_panel_opr}}/g, (results[team].cargo_side_panel_opr + results[team].cargo_front_panel_opr).toFixed(2))
                                    .replace(/{{cargo_cargo_opr}}/g, (results[team].cargo_side_cargo_opr + results[team].cargo_front_cargo_opr).toFixed(2))
                                    .replace(/{{rocket_panel_opr}}/g, (results[team].rocket_high_panel_opr + results[team].rocket_mid_panel_opr + results[team].rocket_low_panel_opr).toFixed(2))
                                    .replace(/{{rocket_cargo_opr}}/g, (results[team].rocket_high_cargo_opr + results[team].rocket_mid_cargo_opr + results[team].rocket_low_cargo_opr).toFixed(2));
          }
        }
      });
    }
    console.log(listHtml);
    // Replace the HTML of #list with final HTML
    document.getElementById("opr_table").innerHTML = listHtml;
    sorttable.makeSortable(document.getElementById("opr_table"));
  });
</script>

</html>