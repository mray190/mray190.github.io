<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>ViperScout</title>

    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Open+Sans:400italic,400,600italic,600,700italic,700,800italic,800">
    <link rel="stylesheet" type="text/css" href="./styles.css">
    <script type="text/javascript" src="dist/sorttable.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-133390567-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-133390567-1');
    </script>
  </head>

  <body class="w3-padding-64">

      <div class="w3-top w3-bar w3-black w3-hide-small">
        <a href="index.html" class="w3-bar-item w3-button" id="home_button">ViperScout</a>
        <a href="all.html" class="w3-bar-item w3-button">All regionals/districts</a>
        <a href="prediction.html" class="w3-bar-item w3-button">Match Prediction</a>
        <a href="#" class="w3-bar-item w3-button w3-mobile w3-right viper-black-hover" id="questions_button">
          <i class="fa fa-question-circle" alt="Questions?"></i>
        </a>
      </div>

    <!-- Navbar on small screens (Hidden on medium and large screens) -->
    <div class="w3-top w3-light-grey w3-hide-large w3-hide-medium" id="myNavbar">
      <div class="w3-bar w3-center w3-large">
        <a href="index.html" class="w3-bar-item w3-button w3-light-grey" style="width:25% !important" id="home_button"><i class="fa fa-home" alt="Home"></i></a>
        <a href="all.html" class="w3-bar-item w3-button w3-light-grey" style="width:25% !important">All</a>
        <a href="prediction.html" class="w3-bar-item w3-button w3-grey" style="width:25% !important">Predict</a>
      </div>
    </div>

    <!-- Page Content -->
    <div class="w3-padding-large" id="main">

      <!-- Container for the regional list -->
      <div class="w3-row" id="search_container">
        <!-- Search box -->
        <div class="w3-threequarter">
          <input class="w3-input w3-border w3-padding" type="text" placeholder="Search for team" id="team_search">
        </div>
        <div class="w3-quarter">
          <button id="team_submit" class="w3-black w3-block" style="margin-top: 8px; height: 40px;">Submit</button>
        </div>
      </div>

      <div class="w3-container w3-center" id="detail_header">
      </div>

      <div class="w3-row w3-margin-top w3-margin-bottom" id="alliance-tabs" style="display:none">
          <button class="w3-half w3-red w3-button" onclick="switchTab('red')">Red</button>
          <button class="w3-half w3-blue w3-button" onclick="switchTab('blue')">Blue</button>
      </div>

      <div class="w3-justify w3-text-black w3-margin-bottom" id="detail_container">
      </div>

      <div class="w3-row w3-margin-top" id="blue_charts" style="display: none;">
        <div class="w3-third w3-padding">
          <canvas id="blue_chart" responsive="true" aspectRatio="1"></canvas>
        </div>
        <div class="w3-third w3-padding">
          <canvas id="blue_cargo_chart" responsive="true" aspectRatio="1"></canvas>
        </div>
        <div class="w3-third w3-padding">
          <canvas id="blue_rocket_chart" responsive="true" aspectRatio="1"></canvas>
        </div>
      </div>

      <div class="w3-row w3-margin-top" id="red_charts" style="display: none;">
        <div class="w3-third w3-padding">
          <canvas id="red_chart" responsive="true" aspectRatio="1"></canvas>
        </div>
        <div class="w3-third w3-padding">
          <canvas id="red_cargo_chart" responsive="true" aspectRatio="1"></canvas>
        </div>
        <div class="w3-third w3-padding">
          <canvas id="red_rocket_chart" responsive="true" aspectRatio="1"></canvas>
        </div>
      </div>


    </div>

    <!-- END PAGE CONTENT -->
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/5.6.0/math.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.bundle.js"></script>
    <script type="text/javascript" src="dist/scripts.js"></script>
    <script src="./dist/bundle.js"></script>
  </body>

<script id="template-detail" type="text/template">
  <h3>Match {{match}} in {{regional}}</h3>
</script>


<script id="template-detail-last" type="text/template">
  <h4>Next match unavailable. Last match official score was blue: {{blue}}, red: {{red}}</h4>
</script>

<script id="header-template-cargoship" type="text/template">
  <thead>
    <tr class="w3-light-grey">
      <th>Team</th>
      <th>Hatch Front</th>
      <th>Hatch Side</th>
      <th>Cargo Front</th>
      <th>Cargo Side</th>
    </tr>
  </thead>
</script>

<script id="template-cargoship" type="text/template">
  <tr>
    <td>{{team}}</td>
    <td>{{hatch_front}}</td>
    <td>{{hatch_side}}</td>
    <td>{{cargo_front}}</td>
    <td>{{cargo_side}}</td>
  </tr>
</script>

<script id="header-template-rocket" type="text/template">
  <thead>
    <tr class="w3-light-grey">
      <th>Team</th>
      <th>Hatch Low</th>
      <th>Hatch Mid</th>
      <th>Hatch Top</th>
      <th>Cargo Low</th>
      <th>Cargo Mid</th>
      <th>Cargo Top</th>
    </tr>
  </thead>
</script>

<script id="template-rocket" type="text/template">
  <tr>
    <td>{{team}}</td>
    <td>{{hatch_low}}</td>
    <td>{{hatch_mid}}</td>
    <td>{{hatch_top}}</td>
    <td>{{cargo_low}}</td>
    <td>{{cargo_mid}}</td>
    <td>{{cargo_top}}</td>
  </tr>
</script>

<script id="header-template-hab" type="text/template">
  <thead>
    <tr class="w3-light-grey">
      <th>Team</th>
      <th>Start</th>
      <th>Endgame</th>
    </tr>
  </thead>
</script>

<script id="template-hab" type="text/template">
  <tr>
    <td>{{team}}</td>
    <td>{{start}}</td>
    <td>{{end}}</td>
  </tr>
</script>

<script id="header-template-overall" type="text/template">
  <thead>
    <tr class="w3-light-grey">
      <th>Team</th>
      <th>OPR</th>
      <th>Ship</th>
      <th>Rocket</th>
      <th>Hab</th>
    </tr>
  </thead>
</script>

<script id="template-overall" type="text/template">
  <tr>
    <td>{{team}}</td>
    <td>{{opr}}</td>
    <td>{{ship}}</td>
    <td>{{rocket}}</td>
    <td>{{hab}}</td>
  </tr>
</script>

<script id="div-template" type="text/template">
  <div class="w3-row" id="{{color}}-details" style="display:none">
    <div class="w3-quarter w3-padding w3-center">
      <h4>Score: {{score}}</h4>
      <table class="sortable w3-hoverable w3-striped w3-table" id="{{color}}-overall">
      </table>
    </div>
    <div class="w3-quarter w3-padding w3-center">
      <h4>Cargoship</h4>
      <table class="sortable w3-hoverable w3-striped w3-table" id="{{color}}-cargoship">
      </table>
    </div>
    <div class="w3-quarter w3-padding w3-center">
      <h4>Rocket</h4>
      <table class="sortable w3-hoverable w3-striped w3-table" id="{{color}}-rocket">
      </table>
    </div>
    <div class="w3-quarter w3-padding w3-center">
      <h4>Hab</h4>
      <table class="sortable w3-hoverable w3-striped w3-table" id="{{color}}-hab">
      </table>
    </div>
  </div>
</script>

<script>
function switchTab(color) {
  var i;
  var red = document.getElementById('red-details');
  var red_charts = document.getElementById('red_charts');
  var blue = document.getElementById('blue-details');
  var blue_charts = document.getElementById('blue_charts');
  if (color=='red') {
    red.style.display = "block";
    red_charts.style.display = "block";
    blue.style.display = "none";  
    blue_charts.style.display = "none"; 
  } else {
    blue.style.display = "block";
    blue_charts.style.display = "block";
    red.style.display = "none"; 
    red_charts.style.display = "none"; 
  }
}
</script>

<script>

    var check = false;
    (function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);
    if (check) {
      Chart.defaults.global.legend.display = false;
    }

    var html_charts = {
        'red': {
          'overall': document.getElementById('red_chart').getContext('2d'),
          'cargo': document.getElementById('red_cargo_chart').getContext('2d'),
          'rocket': document.getElementById('red_rocket_chart').getContext('2d')
        },
        'blue': {
          'overall': document.getElementById('blue_chart').getContext('2d'),
          'cargo': document.getElementById('blue_cargo_chart').getContext('2d'),
          'rocket': document.getElementById('blue_rocket_chart').getContext('2d')
        }
    };

    var chartColors = {
        red: 'rgb(255, 99, 132, 0.4)',
        orange: 'rgb(255, 159, 64, 0.4)',
        dark_orange: 'rgb(255, 109, 64, 0.4)',
        light_orange: 'rgb(255, 209, 64, 0.4)',
        yellow: 'rgb(255, 205, 86, 0.4)',
        green: 'rgb(75, 192, 192, 0.4)',
        blue: 'rgb(54, 162, 235, 0.4)',
        purple: 'rgb(153, 102, 255, 0.4)',
        grey: 'rgb(201, 203, 207, 0.4)'
    };

    var tba = new TBA();
    var colors = [ 'blue', 'red' ];

    var previousTeam = Cookies.get('team');
    if (previousTeam) {
      $('#team_search').val(previousTeam.replace('frc',''));
      lookupTeam(previousTeam);
    }
    
    $('#team_submit').on('click', function() {
      document.getElementById('red_charts').style.display = "none";
      document.getElementById('blue_charts').style.display = "none";
      document.getElementById("detail_container").innerHTML = "";
      document.getElementById("detail_header").innerHTML = "";
      var team = 'frc' + $('#team_search').val();
      Cookies.set('team', team, { expires: 365 });
      lookupTeam(team);
    });

    function lookupTeam(team) {
      tba.getOverallTeamNextMatch(team, function(result_new) {
        if (!result_new) {
          tba.getOverallTeamLastMatch(team, function(result_last) {
            if (result_last)
              calcStats(result_last, false);
          });
        } else {
          calcStats(result_new, true);
        }
      });
    }

    function calcStats(match, new_match) {

      // Setup header
      var detailTemplate = document.getElementById("template-detail");
      var detailLastTemplate = document.getElementById("template-detail-last");
      var detailTemplateHtml = detailTemplate.innerHTML;
      var detailLastTemplateHtml = detailLastTemplate.innerHTML;
      detailTemplateHtml = detailTemplateHtml.replace(/{{match}}/g, match.comp_level.toUpperCase()+match.match_number)
                                          .replace(/{{regional}}/g, match.event_key);
      if (!new_match) {
        detailLastTemplateHtml = detailLastTemplateHtml.replace(/{{red}}/g, match.alliances.red.score)
                                                       .replace(/{{blue}}/g, match.alliances.blue.score);
        document.getElementById("detail_header").innerHTML = detailTemplateHtml + detailLastTemplateHtml;
      } else {
        document.getElementById("detail_header").innerHTML += detailTemplateHtml;
      }

      tba.genOPRs(match.event_key, function(results) {

        for (var color in colors) {

          var teamDataset = [{
                  data: [],
                  backgroundColor: chartColors.green,
                  label: 'Start'
              },{
                  data: [],
                  backgroundColor: chartColors.yellow,
                  label: 'Cargoship'
              },{
                  data: [],
                  backgroundColor: chartColors.red,
                  label: 'Rocket'
              },{
                  data: [],
                  backgroundColor: chartColors.blue,
                  label: 'Climb'
              }];

          var cargoDataset = [{
                  data: [],
                  backgroundColor: chartColors.blue,
                  label: 'Front Hatch'
              },{
                  data: [],
                  backgroundColor: chartColors.green,
                  label: 'Side Hatch'
              },{
                  data: [],
                  backgroundColor: chartColors.orange,
                  label: 'Front Cargo'
              },{
                  data: [],
                  backgroundColor: chartColors.red,
                  label: 'Side Cargo'
              }];

          var rocketDataset = [{
                  data: [],
                  backgroundColor: chartColors.blue,
                  label: 'Low Hatch'
              },{
                  data: [],
                  backgroundColor: chartColors.green,
                  label: 'Mid Hatch'
              },{
                  data: [],
                  backgroundColor: chartColors.purple,
                  label: 'Top Hatch'
              },{
                  data: [],
                  backgroundColor: chartColors.red,
                  label: 'Low Cargo'
              },{
                  data: [],
                  backgroundColor: chartColors.orange,
                  label: 'Mid Cargo'
              },{
                  data: [],
                  backgroundColor: chartColors.yellow,
                  label: 'Top Cargo'
              }];

          var teams = [ match.alliances[colors[color]].team_keys[0].replace('frc',''),
                       match.alliances[colors[color]].team_keys[1].replace('frc',''),
                       match.alliances[colors[color]].team_keys[2].replace('frc','') ];

          // Setup cargo table
          var cargoTemplate = document.getElementById("template-cargoship");
          var cargoHeader = document.getElementById("header-template-cargoship");
          var cargoTemplateHtml = cargoTemplate.innerHTML;
          var cargoHeaderHtml = cargoHeader.innerHTML;
          cargoHeaderHtml = cargoHeaderHtml.replace(/{{color}}/g, colors[color]);
          var cargoHtml = cargoHeaderHtml;

          // Setup rocket table
          var rocketTemplate = document.getElementById("template-rocket");
          var rocketHeader = document.getElementById("header-template-rocket");
          var rocketTemplateHtml = rocketTemplate.innerHTML;
          var rocketHeaderHtml = rocketHeader.innerHTML;
          rocketHeaderHtml = rocketHeaderHtml.replace(/{{color}}/g, colors[color]);
          var rocketHtml = rocketHeaderHtml;

          // Setup rocket table
          var habTemplate = document.getElementById("template-hab");
          var habHeader = document.getElementById("header-template-hab");
          var habTemplateHtml = habTemplate.innerHTML;
          var habHeaderHtml = habHeader.innerHTML;
          habHeaderHtml = habHeaderHtml.replace(/{{color}}/g, colors[color]);
          var habHtml = habHeaderHtml;

          // Setup rocket table
          var overallTemplate = document.getElementById("template-overall");
          var overallHeader = document.getElementById("header-template-overall");
          var overallTemplateHtml = overallTemplate.innerHTML;
          var overallHeaderHtml = overallHeader.innerHTML;
          overallHeaderHtml = overallHeaderHtml.replace(/{{color}}/g, colors[color]);
          var overallHtml = overallHeaderHtml;

          var score = 0;
          for (var team in teams) {
            var result;
            if (!(teams[team] in results)) {
              result = {
                        'cargo_side_panel_opr': 0,
                        'cargo_side_cargo_opr': 0,
                        'cargo_front_panel_opr': 0,
                        'cargo_front_cargo_opr': 0,
                        'rocket_high_panel_opr': 0,
                        'rocket_high_cargo_opr': 0,
                        'rocket_mid_panel_opr': 0,
                        'rocket_mid_cargo_opr': 0,
                        'rocket_low_panel_opr': 0,
                        'rocket_low_cargo_opr': 0,
                        'start_avg': 0,
                        'climb_avg': 0,
                        'opr': 0
                      };
            } else {
               result = results[teams[team]];
            }
            score += result.opr;
            cargoHtml += cargoTemplateHtml.replace(/{{team}}/g, teams[team])
                                          .replace(/{{hatch_front}}/g, result.cargo_front_panel_opr.toFixed(1))
                                          .replace(/{{hatch_side}}/g, result.cargo_side_panel_opr.toFixed(1))
                                          .replace(/{{cargo_front}}/g, result.cargo_front_cargo_opr.toFixed(1))
                                          .replace(/{{cargo_side}}/g, result.cargo_side_cargo_opr.toFixed(1));
            rocketHtml += rocketTemplateHtml.replace(/{{team}}/g, teams[team])
                                          .replace(/{{hatch_low}}/g, result.rocket_low_panel_opr.toFixed(1))
                                          .replace(/{{hatch_mid}}/g, result.rocket_mid_panel_opr.toFixed(1))
                                          .replace(/{{hatch_top}}/g, result.rocket_high_panel_opr.toFixed(1))
                                          .replace(/{{cargo_low}}/g, result.rocket_low_cargo_opr.toFixed(1))
                                          .replace(/{{cargo_mid}}/g, result.rocket_mid_cargo_opr.toFixed(1))
                                          .replace(/{{cargo_top}}/g, result.rocket_high_cargo_opr.toFixed(1));
            habHtml += habTemplateHtml.replace(/{{team}}/g, teams[team])
                                          .replace(/{{start}}/g, result.start_avg.toFixed(1))
                                          .replace(/{{end}}/g, result.climb_avg.toFixed(1));
            overallHtml += overallTemplateHtml.replace(/{{team}}/g, teams[team])
                                          .replace(/{{opr}}/g, result.opr.toFixed(1))
                                          .replace(/{{hab}}/g, (result.start_avg + result.climb_avg).toFixed(1))
                                          .replace(/{{ship}}/g,
                                                    (result.cargo_front_panel_opr +
                                                     result.cargo_side_panel_opr +
                                                     result.cargo_front_cargo_opr +
                                                     result.cargo_side_cargo_opr).toFixed(1))
                                          .replace(/{{rocket}}/g,
                                                    (result.rocket_low_panel_opr +
                                                     result.rocket_mid_panel_opr +
                                                     result.rocket_high_panel_opr +
                                                     result.rocket_low_cargo_opr +
                                                     result.rocket_mid_cargo_opr +
                                                     result.rocket_high_cargo_opr).toFixed(1));
            teamDataset[0].data.push(result.start_avg.toFixed(1));
            teamDataset[1].data.push((result.cargo_front_panel_opr +
                                                     result.cargo_side_panel_opr +
                                                     result.cargo_front_cargo_opr +
                                                     result.cargo_side_cargo_opr).toFixed(1));
            teamDataset[2].data.push((result.rocket_low_panel_opr +
                                                     result.rocket_mid_panel_opr +
                                                     result.rocket_high_panel_opr +
                                                     result.rocket_low_cargo_opr +
                                                     result.rocket_mid_cargo_opr +
                                                     result.rocket_high_cargo_opr).toFixed(1));
            teamDataset[3].data.push(result.climb_avg.toFixed(1));
            cargoDataset[0].data.push(result.cargo_front_panel_opr.toFixed(1));
            cargoDataset[1].data.push(result.cargo_side_panel_opr.toFixed(1));
            cargoDataset[2].data.push(result.cargo_front_cargo_opr.toFixed(1));
            cargoDataset[3].data.push(result.cargo_side_cargo_opr.toFixed(1));
            rocketDataset[0].data.push(result.rocket_low_panel_opr.toFixed(1));
            rocketDataset[1].data.push(result.rocket_mid_panel_opr.toFixed(1));
            rocketDataset[2].data.push(result.rocket_high_panel_opr.toFixed(1));
            rocketDataset[3].data.push(result.rocket_low_cargo_opr.toFixed(1));
            rocketDataset[4].data.push(result.rocket_mid_cargo_opr.toFixed(1));
            rocketDataset[5].data.push(result.rocket_high_cargo_opr.toFixed(1));
          }

          // Fill div
          var detailDiv = document.getElementById("div-template");
          var detailDivHtml = detailDiv.innerHTML;
          detailDivHtml = detailDivHtml.replace(/{{color}}/g, colors[color])
                                       .replace(/{{score}}/g, score.toFixed(0));
          document.getElementById("detail_container").innerHTML += detailDivHtml;

          document.getElementById(colors[color] + "-cargoship").innerHTML = cargoHtml;
          sorttable.makeSortable(document.getElementById(colors[color] + "-cargoship"));
          document.getElementById(colors[color] + "-rocket").innerHTML = rocketHtml;
          sorttable.makeSortable(document.getElementById(colors[color] + "-rocket"));
          document.getElementById(colors[color] + "-hab").innerHTML = habHtml;
          sorttable.makeSortable(document.getElementById(colors[color] + "-hab"));
          document.getElementById(colors[color] + "-overall").innerHTML = overallHtml;
          sorttable.makeSortable(document.getElementById(colors[color] + "-overall"));    
        
          var overallChartData = {
              type: 'bar',
              data: {
                  labels: teams,
                  datasets: teamDataset
              },
              options: {
                  scales: {
                      xAxes: [{ stacked: true }],
                      yAxes: [{
                          ticks: {
                              suggestedMax: 25,
                              beginAtZero: true
                          },
                          stacked: true
                      }]
                  }
              }
          };
          var chart = new Chart(html_charts[colors[color]].overall, overallChartData);
        
          var cargoChartData = {
              type: 'bar',
              data: {
                  labels: teams,
                  datasets: cargoDataset
              },
              options: {
                  scales: {
                      xAxes: [{ stacked: true }],
                      yAxes: [{
                          ticks: {
                              suggestedMax: 10,
                              beginAtZero: true
                          },
                          stacked: true
                      }]
                  }
              }
          };
          var chart = new Chart(html_charts[colors[color]].cargo, cargoChartData);
        
          var rocketChartData = {
              type: 'bar',
              data: {
                  labels: teams,
                  datasets: rocketDataset
              },
              options: {
                  scales: {
                      xAxes: [{ stacked: true }],
                      yAxes: [{
                          ticks: {
                              suggestedMax: 10,
                              beginAtZero: true
                          },
                          stacked: true
                      }]
                  }
              }
          };
          var chart = new Chart(html_charts[colors[color]].rocket, rocketChartData);

          document.getElementById('alliance-tabs').style.display = 'block';
        }
      });
    }
</script>

</html>